<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clothes Shop</title>
    <link rel="stylesheet" href="/css/home.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <header>
        <div class="header">
            <div class="logo" style="display: flex; align-items: center;">
                <a href="/">
                        <img style="width: 80px;" src="/img/delivery_fast.jpg" alt="LOGO">
                </a>
                <div class="category-item" >
                    <div onclick="" class="category-item__home"><a href="/">Cặc Shop</a></div>
                </div>
            </div>
            <form class="search">
                <input class="search__input" type="text" name="search" placeholder="Tìm kiếm sản phẩm">
                <button class="search__btn"><i class="fa-solid fa-magnifying-glass"></i></button>
            </form>
            <div class="other">
                <div class="other__authentication">
                    <li><a href="/login">Login</a></li>
                    <li><a href="/register">Register</a></li>
                </div>
                <div class="other__individual">
                    <li> 
                        <form action="/cart" method="get">
                            <button type="submit" class="cart_button">
                                <i class="fa-solid fa-cart-shopping"></i>
                            </button>
                        </form>
                    </li>
                </div>
            </div>
        </div>
        <div style="background-color: rgb(222, 252, 252);">
            <div class="category">
                {{!-- <div class="category-item" >
                    <div onclick="" class="category-item__home"><a href="/home">Trang chủ</a></div>
                </div> --}}
                <div class="category-item">
                    <div class="category-item__parent" category="nam">Nam</div>
                    <div class="category-item__child">
                        <li class="category_child" classify="ao">Áo</li>
                        <li class="category_child" classify="quan">Quần</li>
                    </div>
                </div>
                <div class="category-item">
                    <div class="category-item__parent" category="nu">Nữ</div>
                    <div class="category-item__child">
                        <li class="category_child" classify="ao">Áo</li>
                        <li class="category_child" classify="quan">Quần</li>
                        <li class="category_child" classify="vay">Váy</li>
                    </div>
                </div>
                <div class="category-item">
                    <div class="category-item__parent" category="tre_em">Trẻ em</div>
                    <div class="category-item__child">
                        <li class="category_child" classify="ao">Áo</li>
                        <li class="category_child" classify="quan">Quần</li>
                    </div>
                </div>
                <div class="category-item">
                    <div class="category-item__parent" category="khac">Khác</div>
                    <div class="category-item__child">
                        <li class="category_child" classify="ao">Áo</li>
                        <li class="category_child" classify="quan">Quần</li>
                    </div>
                </div>   
            </div>
        </div>
        
        
    </header>
    <div  class="content" page="{{page}}" category="{{category_}}">
        {{#if products}}
            {{#each products}}
                <div class="product" onmouseover="slideShow({productId : '{{sum @index 1}}', imageClass : 'img{{sum @index 1}}'})" id="{{sum @index 1}}">
                <a href="/product/{{this._id}}" style="text-decoration: none;">
                    <div class="product__image">
                        <img class="img{{sum @index 1}}" style="display: block;" src="{{this.main_image}}" alt="">
                        <img class="img{{sum @index 1}}" style="display: none;" src="{{getValueAtIndex image_ 0}}" alt="">
                        <img class="img{{sum @index 1}}" style="display: none;" src="{{getValueAtIndex image_ 1}}" alt="">
                        <img class="img{{sum @index 1}}" style="display: none;" src="{{getValueAtIndex image_ 2}}" alt="">
                    </div>
                
                    <div class="product__name">{{this.name}}</div>
                    {{!-- <p class="card-text">{{this.description}}</p> --}}
                    <div>
                        {{!-- <p>Chi con: {{this.remaining_products}} san pham</p> --}}
                    </div>
                    <div class="product__price">{{this.price}} ₫</div>
                
                    {{!-- <div class="product__cart"><i class="fa-solid fa-cart-shopping"></i></div> --}}
                    </div>   
                </a>   
            {{/each}} 
        {{else}}
            <p>Không tìm thấy sản phẩm</p> 
        {{/if}}  
    </div>
 
    <div id="pagination">
        <nav aria-label="Page navigation example">
            <ul class="pagination" style="justify-content: center;">
                <li class="page-item">
                    <a class="page-link" href="#" aria-label="Previous" id="page-item-previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                <li class="page-item"><a class="page-link" href="" id="page-item-1">1</a></li>
                <li class="page-item"><a class="page-link" href="" id="page-item-2">2</a></li>
                <li class="page-item"><a class="page-link" href="" id="page-item-3">3</a></li>
                <li class="page-item">
                    <a class="page-link" href="#" aria-label="Next" id="page-item-next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
    
    <form action="/" method="GET" id="get_category">
        <input type="hidden" name="category" id="category_info">
    </form>
</body>
<footer></footer>

<script>
/////////////////

    var page = document.getElementsByClassName('content')[0].getAttribute('page')
    var category_ = document.getElementsByClassName('content')[0].getAttribute('category')
    console.log(category_.length)
    var pagination = document.getElementById('pagination')
    if(page > 1) {
        document.getElementById('page-item-1').innerText = parseInt(page) - 1
        document.getElementById('page-item-2').innerText = page
        document.getElementById('page-item-3').innerText = parseInt(page) + 1

    }
    var page_links = document.getElementsByClassName('page-link')
    page_links = Array.from(page_links)
    if(category_.length === 0) {
        page_links.forEach(page_link => {
            page_link.href = '?page=' + page_link.innerText
            if(page_link.innerText === page){
                page_link.setAttribute('style', 'background-color: rgba(211, 214, 214, 0.998);')
            }
        })
    } else {
        page_links.forEach(page_link => {
            page_link.href = '?' + category_ +  '&page=' + page_link.innerText
            if(page_link.innerText === page){
                page_link.setAttribute('style', 'background-color: rgba(211, 214, 214, 0.998);')
            }
        })
    }
    var next_page = document.getElementById('page-item-next')
    if(category_.length === 0) {
        next_page.href = '?page=' + (parseInt(page) + 1)
    } else {
        next_page.href = '?' + category_ +  '&page=' + (parseInt(page) + 1)
    }
    var previous_page = document.getElementById('page-item-previous')
    if(category_.length === 0) {
        if(page > 1) {
            previous_page.href = '?page=' + (parseInt(page) - 1)
        } else {
            previous_page.href = '?page=1'
        }
    } else {
        if(page > 1) {
            previous_page.href = '?' + category_ +  '&page=' + (parseInt(page) - 1)
        } else {
            previous_page.href = '?' + category_ +  '&page=1'
        }
    }

//// phan loai theo gioi tinh
    var form_category = document.getElementById('get_category')
    var input_category = document.getElementById('category_info')
    {{!-- var input_classify = document.getElementById('classify_info') --}}

    var categorys = document.getElementsByClassName('category-item__parent')
    categorys = Array.from(categorys)
    categorys.forEach(category => {
        category.onclick = function(event) {
            var sex = event.target.getAttribute('category')
            input_category.value = sex
            form_category.submit()
        }
    })

//// phan loai theo loai hang

    var category_childs = document.getElementsByClassName('category_child')
    category_childs = Array.from(category_childs)
    category_childs.forEach(category_child => {
        category_child.onclick = function(event) {
            var sex = event.target.parentElement.parentElement.getElementsByClassName('category-item__parent')[0].getAttribute('category')
            var classify = event.target.getAttribute('classify')
            console.log(sex + '/' + classify)
            input_category.value = sex + '-' + classify
            //input_classify.value = classify
            form_category.submit()

        }
    })
</script>
<script>
        function slideShow({
            productId = '',
            imageClass = ''
        }){
            var isLoop = true;
            const product = document.getElementById(productId);
            product.addEventListener('mouseenter', () => {
                var myIndex = 0;
                function carousel() {
                var i;
                var x = document.getElementsByClassName(imageClass);
                for (i = 0; i < x.length; i++) {
                    x[i].style.display = "none";  
                }
                myIndex++;
                if (myIndex > x.length) {myIndex = 1}    
                x[myIndex-1].style.display = "block";  
                setTimeout(startSlideShow, 1500);    
                }

                function startSlideShow(){
                    if(isLoop){
                        carousel();
                    }
                }
                startSlideShow()
            });
            product.addEventListener('mouseleave', () => {
                isLoop = false;
                isMouseStop = false
                isMouseStart = true
                var x = document.getElementsByClassName(imageClass);
                x[0].style.display = "block";
                for (i = 1; i < x.length; i++) {
                    x[i].style.display = "none";
                }
            });
        }
    </script>
</html>

{{!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">

    <title>Document</title>
</head>
<body>
    <div id="log_reg">
        <a href="/login">Login</a>
        <br>
        <a href="/register">Register</a>
    </div>
    
    <div id="info_user"></div>

    <div>
        
        <div class="row">
            {{#each products}}
            <div class="col-sm-6 col-lg-3" style="margin-right: 0px;">
                <div class="card mt-4" style="width: 18rem;">
                    <a href="/product/{{this._id}}">
                        <img src="{{this.main_image}}" class="card-img-top" alt="...">
                    </a>
                    <div class="card-body">
                        <p>{{this.name}}</p>
                        <p>{{this.price}} d</p>
                        <p class="card-text">{{this.description}}</p>
                        <p>Chi con: {{this.remaining_products}} san pham</p>
                    </div>
                </div>
            </div>
            {{/each}}
        </div>
        
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js" integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N" crossorigin="anonymous"></script>

<script>
    
    
     
</script>
</html> --}}